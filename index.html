<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTS - Beat The System Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Navigation -->
    <nav class="glass-nav fixed w-full top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 cursor-pointer" onclick="router.navigate('home')">
                    <h1 class="text-2xl font-extrabold tracking-tighter text-slate-900">
                        BTS<span class="text-indigo-600">.</span>
                    </h1>
                </div>

                <!-- Icons -->
                <div class="flex items-center space-x-6">
                    <button onclick="router.navigate('home')" class="text-slate-500 hover:text-indigo-600 transition">
                        <i class="fa-solid fa-store text-xl"></i>
                    </button>
                    <button onclick="router.navigate('cart')" class="relative text-slate-500 hover:text-indigo-600 transition">
                        <i class="fa-solid fa-shopping-bag text-xl"></i>
                        <span id="cart-badge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center transform scale-0 transition-transform duration-200">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main id="app" class="pt-20 pb-12 px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto min-h-screen">
        <!-- Views will be injected here by JS -->
    </main>

    <!-- Footer (Updated to Blue-Black and Detailed) -->
    <footer class="bg-slate-800 border-t border-slate-700 py-10 mt-auto">
        <div class="max-w-6xl mx-auto px-4 text-slate-300">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <h4 class="text-xl font-extrabold text-white mb-3">BTS.</h4>
                    <p class="text-sm">Driven by Ghanaian youth culture, designed for the bold. Beat the System.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-3">Contact</h4>
                    <!-- UPDATED: Made phone number clickable for WhatsApp/call -->
                    <a href="https://wa.me/233504049664" target="_blank" class="text-sm text-slate-300 hover:text-indigo-400 transition block">WhatsApp: +233 50 404 9664</a>
                    <a href="tel:+233504049664" class="text-sm text-slate-300 hover:text-indigo-400 transition block mt-1">Phone: +233 50 404 9664 (Mock)</a>
                    <p class="text-sm">Email: sales@btsghana.com (Mock)</p>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-3">Follow Us</h4>
                    <div class="flex justify-center md:justify-start space-x-4 mt-2">
                        <a href="#" class="text-slate-300 hover:text-indigo-400 transition" aria-label="Instagram"><i class="fab fa-instagram text-xl"></i></a>
                        <a href="#" class="text-slate-300 hover:text-indigo-400 transition" aria-label="Twitter"><i class="fab fa-twitter text-xl"></i></a>
                        <!-- UPDATED: Changed Facebook to TikTok -->
                        <a href="#" class="text-slate-300 hover:text-indigo-400 transition" aria-label="TikTok"><i class="fab fa-tiktok text-xl"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-10 pt-6 border-t border-slate-700 text-center text-sm text-slate-500">
                &copy; 2025 BTS - Beat The System. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-slate-900 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 z-50 flex items-center gap-3">
        <i class="fa-solid fa-check-circle text-green-400"></i>
        <span id="toast-message">Item added to cart</span>
    </div>

    <!-- Custom Modal/Confirmation Box (for Delete Confirmation) -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden items-center justify-center fade-in">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all scale-95">
            <h3 class="text-lg font-bold text-slate-900 mb-2">Remove Item?</h3>
            <p id="modal-message" class="text-sm text-slate-600 mb-6">Are you sure you want to remove this item from your cart?</p>
            <div class="flex justify-end space-x-3">
                <button onclick="hideDeleteModal()" class="px-4 py-2 text-sm font-medium border border-slate-300 rounded-lg hover:bg-slate-50 transition">
                    Cancel
                </button>
                <button id="modal-confirm-btn" class="px-4 py-2 text-sm font-medium bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                    Remove
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- Data ---
        const products = [
            {
                id: 1,
                name: "BTS Trucker Cap",
                price: 100.00, // Assuming GHS or currency generic
                // UPDATED: Added multiple images for the gallery/carousel
                images: ["cp3.jfif", "cp1.jfif", "cp2.jfif", "cp4.jpg"],
                category: "Headwear",
                colors: [
                    { name: "Black", hex: "#000000" },
                    { name: "Red", hex: "#EF4444" },
                    { name: "White", hex: "#FFFFFF", border: true },
                    { name: "Pink", hex: "#EC4899" },
                    { name: "Light Blue", hex: "#38BDF8" },
                    { name: "Army Green", hex: "#4B5320" }
                ],
                sizes: ["One Size"], 
                status: "available",
                description: "Premium mesh trucker cap with 'Beat The System' embroidery. Adjustable snapback closure for the perfect fit."
            },
            {
                id: 2,
                name: "BTS Signature Hoodie",
                price: 200.00,
                // MODIFIED: Updated images array to include the newly uploaded 'blhoodie.jpg'
                images: ["hoodie.jfif", "blhoodie.jpg"],
                category: "Apparel",
                colors: [
                    { name: "White", hex: "#FFFFFF", border: true },
                    { name: "Black", hex: "#000000" }
                ],
                sizes: ["S", "M", "L", "XL"],
                status: "available",
                description: "Heavyweight cotton blend hoodie. Ultra-soft interior with durable print. Perfect for any season."
            },
            {
                id: 3,
                name: "BTS Urban Beanie",
                price: 80.00,
                // UPDATED: Added extra image for the Beanie gallery
                images: ["beany.jfif", "beany1.jfif"],
                category: "Headwear",
                colors: [
                    { name: "Brown", hex: "#EDA268" },
                    { name: "Black", hex: "#000000" }
                ],
                sizes: ["One Size"],
                status: "available",
                description: "Knit cuff beanie keeping you warm and stylish. embroidered logo detail."
            },
            
           {
              id: 5,  
              name: "Hoodie & Shorts",
              price: 350.00, 
             images: ["hoshow.png", "hoshob.png"],
             category: "Apparel", 
             colors: [
                { name: "Black", hex: "#000000" },
                { name: "Ash", hex: "A9ACB2", border: true }
           
          ],
              sizes: ["One Size"], 
              status: "available", 
              description: "Heavyweight cotton blend hoodie & shorts. Ultra-soft interior with durable print. Perfect for any season."
            },
            {
                id: 4,
                name: "BTS Essential T-Shirt",
                price: 120.00,
                images: ["tshirt_placeholder"], 
                category: "Apparel",
                colors: [
                    { name: "White", hex: "#FFFFFF", border: true },
                    { name: "Black", hex: "#000000" }
                ],
                sizes: ["S", "M", "L", "XL"],
                status: "coming_soon",
                description: "The classic essential tee. Coming soon to the store."
            }
        ];

        // --- State Management ---
        const state = {
            cart: JSON.parse(localStorage.getItem('bts_cart')) || [],
            currentView: 'home',
            selectedProduct: null,
            form: {
                color: null,
                size: null
            },
            itemToDelete: null, // Tracks the cartId of the item to be deleted
            currentImageIndex: 0 // New: Tracks current image for product details gallery
        };

        const WHATSAPP_NUMBER = "233504049664";

        // --- Router & Views ---
        const router = {
            navigate: (view, productId = null) => {
                state.currentView = view;
                if (productId) {
                    state.selectedProduct = products.find(p => p.id === productId);
                    // Reset form selection and ensure defaults are set
                    state.form.color = state.selectedProduct.colors[0].name;
                    state.form.size = state.selectedProduct.sizes[0];
                    // Reset image index for the new product
                    state.currentImageIndex = 0; 
                }
                render();
                window.scrollTo(0, 0);
            }
        };

        // --- View Components ---

        function HomeView() {
            return `
                <div class="fade-in">
                    <!-- New Hero/Header Text (Ghanaian Youth Startup Feel) -->
                    <header class="text-center py-12 md:py-16 bg-indigo-50 rounded-2xl mb-12 shadow-inner">
                        <p class="text-xs font-semibold uppercase tracking-widest text-indigo-600 mb-2">From Accra to the World</p>
                        <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 tracking-tight leading-snug">
                            BEAT THE SYSTEM. <span class="text-indigo-600">GH YOUTH CULTURE.</span>
                        </h1>
                        <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-700">
                            We're a startup born from the hustle and creativity of Ghana's youth. Built on passion, designed for the streets. Shop the limited collection. 
                            First Whatsapp order checkout in Ghana,no need to sign up.
                        </p>
                    </header>

                    <div class="mb-8 text-center sm:text-left">
                        <h2 class="text-3xl font-bold text-slate-900">Latest Drops</h2>
                        <p class="text-slate-500 mt-2">Exclusive collection. Limited stock.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${products.map(product => ProductCard(product)).join('')}
                    </div>
                </div>
            `;
        }

        function ProductCard(product) {
            const isComingSoon = product.status === 'coming_soon';
            // Use the first image in the array for the card view
            const imageSrc = product.id === 4 ? 
                'https://placehold.co/600x600/f1f5f9/94a3b8?text=Coming+Soon' : 
                product.images[0];

            return `
                <div class="group relative bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition-shadow duration-300">
                    <div class="aspect-square w-full overflow-hidden bg-slate-50 relative">
                        <img src="${imageSrc}" 
                             alt="${product.name}" 
                             class="h-full w-full object-cover object-center group-hover:scale-105 transition-transform duration-500 ${isComingSoon ? 'opacity-50 grayscale' : ''}"
                             onerror="this.src='https://placehold.co/600x600/f1f5f9/94a3b8?text=Image+Load+Error'">
                        
                        ${isComingSoon ? `
                            <div class="absolute inset-0 flex items-center justify-center bg-black/10">
                                <span class="bg-black text-white px-3 py-1 text-xs font-bold uppercase tracking-wider rounded">Coming Soon</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="text-sm font-medium text-slate-900">
                                    ${!isComingSoon ? `<a href="#" onclick="router.navigate('details', ${product.id})" class="hover:text-indigo-600 focus:outline-none"><span aria-hidden="true" class="absolute inset-0"></span>${product.name}</a>` : `<span class="text-slate-500">${product.name}</span>`}
                                </h3>
                                <p class="text-sm text-slate-500">${product.category}</p>
                            </div>
                            <p class="text-sm font-bold text-slate-900">${isComingSoon ? '--' : 'GH₵ ' + product.price}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function DetailsView() {
            if (!state.selectedProduct) return HomeView();
            const product = state.selectedProduct;
            
            // Get the current image URL for the gallery
            const currentImageUrl = product.images[state.currentImageIndex] || 'https://placehold.co/600x600/f1f5f9/94a3b8?text=No+Image';

            return `
                <div class="fade-in max-w-5xl mx-auto">
                    <!-- Breadcrumb -->
                    <button onclick="router.navigate('home')" class="flex items-center text-sm text-slate-500 hover:text-indigo-600 mb-6 transition">
                        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Products
                    </button>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 lg:gap-16">
                        <!-- Image Gallery (Carousel) -->
                        <div class="aspect-square bg-slate-50 rounded-3xl overflow-hidden shadow-sm relative">
                            <img src="${currentImageUrl}" 
                                 alt="${product.name} - View ${state.currentImageIndex + 1}" 
                                 class="w-full h-full object-cover transition-opacity duration-300" 
                                 onerror="this.src='https://placehold.co/600x600/f1f5f9/94a3b8?text=No+Image'">
                            
                            <!-- Navigation Controls (Only show if more than one image exists) -->
                            ${product.images.length > 1 ? `
                                <button onclick="prevImage()" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 backdrop-blur-sm p-3 rounded-full shadow-lg text-slate-800 hover:bg-white transition z-10 w-10 h-10 flex items-center justify-center">
                                    <i class="fa-solid fa-chevron-left text-sm"></i>
                                </button>
                                <button onclick="nextImage()" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 backdrop-blur-sm p-3 rounded-full shadow-lg text-slate-800 hover:bg-white transition z-10 w-10 h-10 flex items-center justify-center">
                                    <i class="fa-solid fa-chevron-right text-sm"></i>
                                </button>
                            ` : ''}
                            
                            <!-- Dots Indicator (Only show if more than one image exists) -->
                            ${product.images.length > 1 ? `
                                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                                    ${product.images.map((_, index) => `
                                        <div class="w-2 h-2 rounded-full transition-all duration-300 ${state.currentImageIndex === index ? 'bg-white w-5' : 'bg-white/50 hover:bg-white/80'}"></div>
                                    `).join('')}
                                </div>
                            ` : ''}

                        </div>

                        <!-- Product Info -->
                        <div class="flex flex-col">
                            <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-900 tracking-tight">${product.name}</h1>
                            <p class="text-2xl text-indigo-600 font-bold mt-2">GH₵ ${product.price.toFixed(2)}</p>
                            
                            <p class="text-slate-600 mt-6 leading-relaxed">${product.description}</p>

                            <!-- Customization Form -->
                            <div class="mt-8 space-y-6">
                                <!-- Colors -->
                                <div>
                                    <h3 class="text-sm font-medium text-slate-900">Color</h3>
                                    <div class="flex items-center space-x-3 mt-3">
                                        ${product.colors.map(c => `
                                            <button 
                                                onclick="selectColor('${c.name}')"
                                                class="w-10 h-10 rounded-full focus:outline-none ring-2 ring-offset-2 transition-all ${state.form.color === c.name ? 'ring-indigo-600 scale-110' : 'ring-transparent hover:scale-110'}"
                                                style="background-color: ${c.hex}; ${c.border ? 'border: 1px solid #e2e8f0;' : ''}"
                                                title="${c.name}"
                                            ></button>
                                        `).join('')}
                                    </div>
                                    <p class="text-xs text-slate-500 mt-2">Selected: <span class="font-medium text-slate-900">${state.form.color}</span></p>
                                </div>

                                <!-- Sizes -->
                                <div>
                                    <h3 class="text-sm font-medium text-slate-900">Size</h3>
                                    <div class="grid grid-cols-4 gap-3 mt-3 sm:grid-cols-6">
                                        ${product.sizes.map(s => `
                                            <button 
                                                onclick="selectSize('${s}')"
                                                class="border rounded-lg py-3 text-sm font-medium hover:border-indigo-600 focus:outline-none transition-all ${state.form.size === s ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white text-slate-900 border-slate-200'}"
                                            >
                                                ${s}
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>

                            <!-- Actions (Buttons are now smaller: py-3 px-6) -->
                            <div class="mt-10 flex flex-col sm:flex-row gap-4">
                                <button onclick="addToCart()" class="flex-1 bg-white border-2 border-slate-900 text-slate-900 py-3 px-6 rounded-xl font-bold hover:bg-slate-50 transition active:scale-95">
                                    Add to Cart
                                </button>
                                <button onclick="buyNow()" class="flex-1 bg-indigo-600 text-white py-3 px-6 rounded-xl font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition active:scale-95 flex justify-center items-center gap-2">
                                    <i class="fa-brands fa-whatsapp text-xl"></i> Order Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function CartView() {
            // Calculate subtotal based on price * quantity
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (state.cart.length === 0) {
                return `
                    <div class="fade-in text-center py-20">
                        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-slate-100 mb-6">
                            <i class="fa-solid fa-shopping-basket text-3xl text-slate-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-900">Your cart is empty</h2>
                        <p class="text-slate-500 mt-2 mb-8">Looks like you haven't added anything yet.</p>
                        <button onclick="router.navigate('home')" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-medium hover:bg-indigo-700 transition">
                            Start Shopping
                        </button>
                    </div>
                `;
            }

            return `
                <div class="fade-in max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-slate-900 mb-8">Shopping Cart (${state.cart.length} unique item${state.cart.length !== 1 ? 's' : ''})</h2>
                    
                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Cart Items -->
                        <div class="flex-1 space-y-4">
                            ${state.cart.map((item, index) => `
                                <div class="flex gap-4 bg-white p-4 rounded-xl border border-slate-100 shadow-sm relative">
                                    
                                    <!-- Delete Button -->
                                    <button 
                                        onclick="showDeleteModal(${item.cartId}, '${item.name}', '${item.color}', '${item.size}')" 
                                        class="absolute top-2 right-2 p-1 text-slate-400 hover:text-red-500 transition rounded-full hover:bg-slate-50"
                                        title="Remove item"
                                    >
                                        <i class="fa-solid fa-xmark text-lg"></i>
                                    </button>

                                    <div class="w-24 h-24 bg-slate-50 rounded-lg overflow-hidden flex-shrink-0">
                                        <!-- Use the first image for the cart view -->
                                        <img src="${item.images[0]}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/600x600/f1f5f9/94a3b8?text=No+Image'">
                                    </div>
                                    <div class="flex-1 flex flex-col justify-between pr-8">
                                        <div>
                                            <h3 class="font-semibold text-slate-900">${item.name}</h3>
                                            <!-- Check if size is 'One Size' or a true variant -->
                                            ${item.size && item.size !== 'One Size' ? 
                                                `<p class="text-sm text-slate-500 mt-1">Color: ${item.color} | Size: ${item.size}</p>` : 
                                                `<p class="text-sm text-slate-500 mt-1">Color: ${item.color} ${item.size === 'One Size' ? '| One Size' : ''}</p>`
                                            }
                                        </div>
                                        
                                        <!-- UPDATED: Added flex-col on mobile and gap-3 for separation -->
                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mt-2 gap-3"> 
                                            <!-- Quantity Controls -->
                                            <div class="flex items-center space-x-2 border border-slate-200 rounded-lg p-1 w-fit">
                                                <button 
                                                    onclick="updateQuantity(${item.cartId}, -1)" 
                                                    class="w-8 h-8 flex items-center justify-center text-slate-500 hover:bg-slate-100 rounded-md transition disabled:opacity-50"
                                                    title="Decrease Quantity"
                                                    ${item.quantity <= 1 ? 'disabled' : ''}
                                                >
                                                    <i class="fa-solid fa-minus text-xs"></i>
                                                </button>
                                                <span class="font-bold text-sm w-4 text-center">${item.quantity}</span>
                                                <button 
                                                    onclick="updateQuantity(${item.cartId}, 1)" 
                                                    class="w-8 h-8 flex items-center justify-center text-slate-500 hover:bg-slate-100 rounded-md transition"
                                                    title="Increase Quantity"
                                                >
                                                    <i class="fa-solid fa-plus text-xs"></i>
                                                </button>
                                            </div>
                                            <!-- Price -->
                                            <p class="font-bold text-indigo-600">GH₵ ${(item.price * item.quantity).toFixed(2)}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Summary -->
                        <div class="lg:w-80">
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm sticky top-24">
                                <h3 class="font-bold text-lg mb-4">Order Summary</h3>
                                <div class="flex justify-between mb-2 text-slate-600">
                                    <span>Subtotal</span>
                                    <span>GH₵ ${subtotal.toFixed(2)}</span>
                                </div>
                                <div class="flex justify-between mb-6 text-slate-600">
                                    <span>Delivery</span>
                                    <span class="text-xs text-slate-400 mt-1">Calculated via WhatsApp</span>
                                </div>
                                <div class="border-t border-slate-100 pt-4 mb-6 flex justify-between font-bold text-lg">
                                    <span>Total</span>
                                    <span>GH₵ ${subtotal.toFixed(2)}</span>
                                </div>
                                <button onclick="checkout()" class="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-green-200 transition active:scale-95 flex items-center justify-center gap-2">
                                    <i class="fa-brands fa-whatsapp"></i> Proceed to Checkout
                                </button>
                                <p class="text-xs text-center text-slate-400 mt-4">
                                    Order details will be sent to our WhatsApp for processing.Don't edit message for clarity.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Logic & Actions (Gallery functions added here) ---

        function prevImage() {
            const product = state.selectedProduct;
            if (!product || product.images.length <= 1) return;

            state.currentImageIndex = (state.currentImageIndex - 1 + product.images.length) % product.images.length;
            render();
        }

        function nextImage() {
            const product = state.selectedProduct;
            if (!product || product.images.length <= 1) return;

            state.currentImageIndex = (state.currentImageIndex + 1) % product.images.length;
            render();
        }

        function render() {
            const app = document.getElementById('app');
            // Use fade-in class on the view container for smoother transitions
            if (state.currentView === 'home') app.innerHTML = HomeView();
            else if (state.currentView === 'details') app.innerHTML = DetailsView();
            else if (state.currentView === 'cart') app.innerHTML = CartView();
            
            updateCartBadge();
        }

        function selectColor(colorName) {
            state.form.color = colorName;
            render(); // Re-render to update UI selection state
        }

        function selectSize(size) {
            state.form.size = size;
            render();
        }

        function addToCart() {
            const newItem = {
                ...state.selectedProduct,
                color: state.form.color,
                size: state.form.size,
            };

            // Check if item with same ID, color, and size already exists in cart
            const existingItem = state.cart.find(item => 
                item.id === newItem.id && 
                item.color === newItem.color && 
                item.size === newItem.size
            );

            if (existingItem) {
                // If exists, increment quantity
                existingItem.quantity += 1;
                showToast(`Increased quantity of ${newItem.name}`);
            } else {
                // If new, add with quantity 1
                newItem.quantity = 1;
                // Add a unique ID for distinct cart lines (important for removing/updating quantity)
                newItem.cartId = Date.now(); 
                state.cart.push(newItem);
                showToast(`Added ${newItem.name} to cart`);
            }
            
            saveCart();
            updateCartBadge();
        }

        function updateQuantity(cartId, delta) {
            const item = state.cart.find(item => item.cartId === cartId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    // Remove item if quantity drops to 0 or below
                    state.cart = state.cart.filter(i => i.cartId !== cartId);
                    showToast(`Removed item from cart`);
                } else {
                    showToast(`Updated quantity for ${item.name}`);
                }
                saveCart();
                render();
            }
        }
        
        // --- Delete Confirmation Modal Logic ---

        function showDeleteModal(cartId, name, color, size) {
            state.itemToDelete = cartId;
            const modal = document.getElementById('delete-modal');
            const messageEl = document.getElementById('modal-message');
            const confirmBtn = document.getElementById('modal-confirm-btn');

            messageEl.innerHTML = `Are you sure you want to remove <span class="font-semibold">${name} (${color} / ${size})</span> from your cart?`;
            
            // Set up the confirm button's action dynamically
            confirmBtn.onclick = () => { deleteItem(); };

            modal.style.display = 'flex'; // Show modal
        }

        function hideDeleteModal() {
            state.itemToDelete = null;
            document.getElementById('delete-modal').style.display = 'none'; // Hide modal
        }

        function deleteItem() {
            if (state.itemToDelete === null) return;
            
            // Filter out the item matching the cartId
            const initialLength = state.cart.length;
            state.cart = state.cart.filter(item => item.cartId !== state.itemToDelete);
            
            if (state.cart.length < initialLength) {
                 showToast('Item successfully removed!');
            }

            hideDeleteModal();
            saveCart();
            render();
        }


        function saveCart() {
            localStorage.setItem('bts_cart', JSON.stringify(state.cart));
        }

        function updateCartBadge() {
            // Count total number of items (sum of quantities)
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);

            const badge = document.getElementById('cart-badge');
            badge.textContent = totalItems;
            if (totalItems > 0) {
                badge.classList.remove('scale-0');
                badge.classList.add('scale-100');
            } else {
                badge.classList.remove('scale-100');
                badge.classList.add('scale-0');
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toast-message');
            msgEl.textContent = msg;
            toast.classList.remove('translate-y-20');
            setTimeout(() => {
                toast.classList.add('translate-y-20');
            }, 3000);
        }

        // --- WhatsApp Logic ---

        function buyNow() {
            const p = state.selectedProduct;
            // For Buy Now, assume quantity is 1
            const text = `*New Order Request (Quick Buy)*\n\nI would like to order:\nItem: ${p.name}\nQuantity: 1\nSize: ${state.form.size}\nColor: ${state.form.color}\nPrice: GH₵ ${p.price}\n\nPlease confirm availability and total cost.`;
            openWhatsApp(text);
        }

        function checkout() {
            if (state.cart.length === 0) return;
            
            let text = `*New Order Request (Web Cart)*\n\nOrder Details:\n`;
            let total = 0;
            
            state.cart.forEach((item, i) => {
                // Updated WhatsApp message to include quantity and unit price
                text += `${i + 1}. ${item.name} | Qty: ${item.quantity} | Color: ${item.color} | Size: ${item.size} | Unit Price: GH₵ ${item.price}\n`;
                total += item.price * item.quantity;
            });
            
            text += `\n*Total Order Amount: GH₵ ${total.toFixed(2)}*\n\nPlease confirm my order and delivery details.`;
            openWhatsApp(text);
        }

        function openWhatsApp(text) {
            const encoded = encodeURIComponent(text);
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encoded}`, '_blank');
        }

        // --- Init ---
        // Initial Render
        render();

    </script>
</body>
</html>
